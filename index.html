<!DOCTYPE html>
<html>
	<head>
		<!-- <script src="mint.js" type="text/javascript"></script> -->
		<meta charset="utf-8" />
		<title>Cabutan Bertuah - Sambutan Hari Keluarga FAMA</title>		
		<link href="demo.css" rel="stylesheet" />
		<style>
			.crappy-plastic-part-made-in-china {
				background-color: #222;
				height: 3em;
				font-size: 6em;
				overflow: hidden;
			}
			.pad {
                display: flex;
				width: 8.9em;
				margin: 0 auto;
				height: 1.8em;
			}
			ul {
				list-style: none;
				padding: 0;
				margin: -4.25em 0 0 0;
				width: 1.5em;
				height: 12em;
				float: center;
			}
			li {
				height: 2.2em;
				width: 0.9em;
				line-height: 2;
				background-color: #222;
				color: #fff;
				text-align: center;
				cursor: pointer;
				font-size: 2em;
				font-weight: bold;
				font-family: "Helvetica Neue", Arial, sans-serif;
			}
				li.roundabout-in-focus {
					cursor: default;
				}
			li span {
				display: block;
				padding-top: 0em;
			}

			#carbonads-container {
				clear: both;
				margin-top: 1em;
			}
			#carbonads-container .carbonad {
				margin: 0 auto;
			}
			/* Responsive table & button styles */
#history-table {
    font-size: 1.1em;
    width: 95%;
    max-width: 500px;
    margin: 2em auto;
    text-align: center;
    border-collapse: collapse;
}
#history-table th, #history-table td {
    padding: 0.5em 0.7em;
    text-align: center;
}
#history-table th {
    background: #f2f2f2;
}
#history-table tr:nth-child(even) {
    background: #fafafa;
}

.interact {
    text-align: center;
    margin: 2em 0 1em 0;
}
.interact select,
.interact a {
    font-size: 1.1em;
    padding: 0.5em 1.2em;
    margin: 0.3em 0.5em;
    border-radius: 0.5em;
    border: none;
    background: #2980b9;
    color: #fff;
    cursor: pointer;
    transition: background 0.2s;
    display: inline-block;
}
.interact select {
    background: #fff;
    color: #222;
    border: 1px solid #2980b9;
}
.interact a:hover,
.interact select:focus {
    background: #3498db;
    color: #fff;
}

@media (max-width: 600px) {
    #history-table {
        font-size: 0.95em;
        width: 100%;
        max-width: 100vw;
    }
    .interact select,
    .interact a {
        font-size: 1em;
        padding: 0.4em 0.7em;
        margin: 0.2em 0.2em;
    }
}
h2 {
    text-align: center;
    font-size: 2em;
    margin-top: 2em;
    font-weight: bold;
}
		</style>
	</head>
<body>
<h1>Nombor Bertuah</h1>
	<div class="crappy-plastic-part-made-in-china">
  <div class="pad">
    <ul><li></li></ul>
    <ul id="digit-3">
      <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li>
    </ul>
    <ul id="digit-2">
      <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li>
    </ul>
    <ul id="digit-1">
      <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li>
    </ul>
    <ul id="digit-0">
      <li>0</li><li>1</li><li>2</li><li>3</li><li>4</li><li>5</li><li>6</li><li>7</li><li>8</li><li>9</li>
    </ul>
    <ul><li></li></ul>
  </div>
</div>
<div class="interact">
    <select id="draw-count">
        <option value="1">1 Cabutan</option>
        <option value="10">10 Cabutan Serentak</option>
        <option value="20">20 Cabutan Serentak</option>
    </select>
    <a href="#" id="contribute">Cabutan</a>
    <a href='#' onclick='location.reload(true); return false;'>Set Semula</a>
</div>

<!-- Table untuk paparan nombor yang sudah keluar -->
<h2>Senarai Nombor Yang Sudah Keluar</h2>
<table id="history-table" border="1" style="margin-top:1em;">
    <thead>
        <tr>
            <th>Bil</th>
            <th>Nombor</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>
<canvas id="fireworks-canvas" style="position:fixed;pointer-events:none;top:0;left:0;width:100vw;height:100vh;z-index:9999;"></canvas>
<audio id="cheer-audio" src="efek.mp3" preload="auto"></audio>
    
<script src="jquery.js"></script>
<script src="jquery.roundabout2.js"></script>
<script src="jquery.roundabout-shapes2.js"></script>
<script src="jquery.easing.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
function showFireworks() {
    // Bunga api tengah
    confetti({
        particleCount: 600,
        spread: 180,
        startVelocity: 120,
        scalar: 1.4,
        origin: { y: 0.6 }
    });

    // Bunga api dari bucu kiri bawah
    confetti({
        particleCount: 120,
        angle: 60,
        spread: 80,
        startVelocity: 90,
        scalar: 1.2,
        origin: { x: 0, y: 1 }
    });

    // Bunga api dari bucu kanan bawah
    confetti({
        particleCount: 120,
        angle: 120,
        spread: 80,
        startVelocity: 90,
        scalar: 1.2,
        origin: { x: 1, y: 1 }
    });

    // Mainkan bunyi sorakan selepas bunga api keluar
    setTimeout(function() {
        var audio = document.getElementById('cheer-audio');
        if (audio) {
            audio.currentTime = 0;
            audio.play();
        }
    }, 400); // mainkan selepas 0.4 saat bunga api
}

var count = 0,
    clickable = true,
    historyNumbers = []; // Array untuk simpan nombor yang sudah keluar

$(document).ready(function() {
    // Pastikan roundabout hanya pada digit
    $('ul[id^="digit-"]').roundabout({
        shape: "waterWheel",
        duration: 1200 // dalam milisaat (1200ms = 1.2 saat)
    });

    $('#contribute').click(function() {
        if (!clickable) {
            return false;
        }
        $('.interact a').fadeTo(100, 0.5);
        clickable = false;

        var drawCount = parseInt($('#draw-count').val(), 10);
        var cabutanBaru = [];
        var maxTry = 5000, tryCount = 0;

        if (historyNumbers.length >= 1500) {
            alert("Semua nombor telah dicabut!");
            $('.interact a').fadeTo(100, 1);
            clickable = false;
            return false;
        }

        while (cabutanBaru.length < drawCount && tryCount < maxTry) {
            var num = Math.floor((Math.random() * 1500) + 1);
            if (historyNumbers.indexOf(num) === -1 && cabutanBaru.indexOf(num) === -1) {
                cabutanBaru.push(num);
            }
            tryCount++;
            if (historyNumbers.length + cabutanBaru.length >= 1500) break;
        }

        if (cabutanBaru.length === 0) {
            alert("Tiada nombor baru boleh dicabut.");
            $('.interact a').fadeTo(100, 1);
            clickable = false;
            return false;
        }

        // Animasi digit untuk nombor terakhir sahaja
        applyCount(cabutanBaru[cabutanBaru.length - 1]);
        showFireworks();

        // Simpan semua nombor ke dalam sejarah dan kemas kini jadual
        historyNumbers = historyNumbers.concat(cabutanBaru);
        updateHistoryTable();

        return false;
    });

    $('#how-much').click(function() {
        alert('The counter is currently at ' + count + '.');
        return false;
    });
});

// Fungsi untuk kemas kini jadual sejarah (4 digit)
function updateHistoryTable() {
    var tbody = $('#history-table tbody');
    tbody.empty();
    for (var i = 0; i < historyNumbers.length; i++) {
        var num = historyNumbers[i].toString().padStart(4, '0');
        tbody.append('<tr><td>' + (i + 1) + '</td><td>' + num + '</td></tr>');
    }
}

// Fungsi untuk animasi digit (4 digit)
function applyCount(total) {
    var str = total.toString().padStart(4, '0');
    for (var i = 0; i < 4; i++) {
        var part = parseInt(str[i], 10);
        var $ul = $('#digit-' + (3 - i));
        if ($ul.length && $ul.data('roundabout')) {
            var child = $ul.data('roundabout').childInFocus;
            var factor = (part < child) ? (10 + part) - child : part - child;
            var distance = factor * 36;
            if (i < 3) {
                $ul.roundabout('animateToDelta', -distance);
            } else {
                $ul.roundabout('animateToDelta', -distance, { duration: 1200 }, function() {
                    $('.interact a').fadeTo(100, 1);
                    clickable = true;
                });
            }
        }
    }
}

// Unlock audio pada klik pertama
document.addEventListener('click', function enableAudio() {
    var audio = document.getElementById('cheer-audio');
    if (audio) {
        audio.muted = false;
        audio.play().then(() => {
            audio.pause();
            audio.currentTime = 0;
            document.removeEventListener('click', enableAudio);
        }).catch(() => {});
    }
});

console.log('jQuery:', typeof $);
console.log('Roundabout:', typeof $.fn.roundabout);
</script>

</body>
</html>